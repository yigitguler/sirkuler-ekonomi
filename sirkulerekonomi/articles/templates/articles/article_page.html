{% extends "base.html" %}
{% load wagtailcore_tags wagtailimages_tags cache %}

{% block title %}{{ page.title }} – Sirküler Ekonomi{% endblock %}
{% block meta_description %}{{ page.intro|striptags|truncatewords:30 }}{% endblock %}
{% block og_type %}article{% endblock %}
{% block og_title %}{{ page.title }}{% endblock %}
{% block og_description %}{{ page.intro|striptags|truncatewords:30 }}{% endblock %}

{% block og_image_meta %}
{% if page.main_image %}
{% image page.main_image width-1200 as og_img %}
<meta property="og:image" content="{{ request.scheme }}://{{ request.get_host }}{{ og_img.url }}">
{% else %}
{{ block.super }}
{% endif %}
{% endblock %}

{% block extra_meta %}
<meta property="article:published_time" content="{{ page.first_published_at|date:'c' }}">
{% if page.last_published_at %}<meta property="article:modified_time" content="{{ page.last_published_at|date:'c' }}">{% endif %}
{% if article_schema_json %}
<script type="application/ld+json">{{ article_schema_json|safe }}</script>
{% endif %}
{% endblock %}

{% block content %}
{% cache 600 article_content page.id page.last_published_at %}
<article class="max-w-3xl mx-auto">
    <header class="mb-8">
        <h1 class="font-display text-3xl sm:text-4xl md:text-5xl font-bold text-forest-900 leading-tight">{{ page.title }}</h1>
        <div class="flex flex-wrap items-center gap-3 mt-4 text-ink-500 text-sm">
            <time datetime="{{ page.first_published_at|date:'c' }}">{{ page.first_published_at|date:"d F Y" }}</time>
        </div>
        {% if page.main_image %}
        <figure class="mt-6 rounded-xl overflow-hidden shadow-lg">
            {% image page.main_image width-800 class="w-full h-auto" alt=page.title %}
        </figure>
        {% endif %}
    </header>

    {% if page.intro %}
    <p class="text-xl text-ink-700 font-medium mb-8">{{ page.intro }}</p>
    {% endif %}

    <div class="prose prose-lg max-w-none prose-headings:font-display prose-headings:text-forest-900 prose-p:text-ink-700 prose-a:text-forest-600 prose-a:no-underline hover:prose-a:underline prose-blockquote:border-forest-400 prose-blockquote:bg-gray-50 prose-blockquote:py-1 prose-blockquote:px-4 prose-img:rounded-lg">
        {% for block in page.body %}
        {% if block.block_type == 'heading' %}
        <h2 class="font-display text-2xl font-bold text-forest-900 mt-10 mb-4">{{ block.value }}</h2>
        {% elif block.block_type == 'paragraph' %}
        <div class="mb-4">{{ block.value|richtext }}</div>
        {% elif block.block_type == 'image' %}
        <figure class="my-8">
            {% with alt_text=block.value.title|default:page.title %}
            {% image block.value width-800 class="w-full h-auto rounded-lg" alt=alt_text %}
            {% endwith %}
        </figure>
        {% elif block.block_type == 'blockquote' %}
        <blockquote class="border-l-4 border-forest-400 bg-gray-50 py-2 px-4 my-6 italic text-ink-700">{{ block.value }}</blockquote>
        {% endif %}
        {% endfor %}
    </div>
</article>
{% endcache %}
{% endblock %}
